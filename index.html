<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="shortcut icon" href="favicon.ico" type="image/x-icon">
    <link rel="manifest" href="manifest.json">
    <title>Meu github</title>
</head>
<body>
    <button id="setup_button" onclick="installApp()">instalar</button>
    <br>teste bem sucedido
    <br>11
    <br>empresa
</body>
<script>



    if ('serviceWorker' in navigator) {
        navigator.serviceWorker.register('sw.js', {scope: '/github/'})
        .then(function () {
            console.log('service worker registered');
            permissaoSync();
        })
        .catch(function () {
            console.warn('service worker failed');
        });
    }

    async function permissaoSync(){
        const status = await navigator.permissions.query({
            name: 'periodic-background-sync',
        });
        if(status === 'granted'){
            console.log("permitido sync");
        }else{
            console.log("nao permitido sync", status);
        }
    }

    Notification.requestPermission().then((permission) => {
        console.log(permission);
        if(permission === "granted"){
            //var notification = new Notification("Seus avisos de novas OSs apareceram aqui.");
        }
    });


    let deferredPrompt; // Allows to show the install prompt
    let setupButton;

    window.addEventListener('beforeinstallprompt', (e) => {
        // Prevent Chrome 67 and earlier from automatically showing the prompt
        e.preventDefault();
        // Stash the event so it can be triggered later.
        deferredPrompt = e;
        console.log("beforeinstallprompt fired");
        if (setupButton == undefined) {
            setupButton = document.getElementById("setup_button");
        }
        // Show the setup button
        setupButton.style.display = "inline";
        setupButton.disabled = false;
    });

    function installApp() {
        // Show the prompt
        deferredPrompt.prompt();
        setupButton.disabled = true;
        // Wait for the user to respond to the prompt
        deferredPrompt.userChoice
            .then((choiceResult) => {
                if (choiceResult.outcome === 'accepted') {
                    console.log('PWA setup accepted');
                    // hide our user interface that shows our A2HS button
                    setupButton.style.display = 'none';
                } else {
                    console.log('PWA setup rejected');
                }
                deferredPrompt = null;
            });
    }

    window.addEventListener('appinstalled', (evt) => {
        console.log("appinstalled fired", evt);
    });


</script>
</html>